import { expect } from "chai";
import { BigNumber } from "ethers";
import { deployments, ethers, getNamedAccounts} from "hardhat";
import "hardhat-deploy-ethers";


describe("GatekeeperOne", async () =>{

  it("Should execute exploit", async () =>{
    await deployments.fixture(["GatekeeperOne","GatekeeperOneExploit"])
    const {exploiter}= await getNamedAccounts()
    const exploiterAcc= await ethers.getSigner(exploiter)
    const gatekeeperOneDeployment=await deployments.get('GatekeeperOne')
    const gatekeeperOneExploitDeployment=await deployments.get('GatekeeperOneExploit')
    const gatekeeperOne = await ethers.getContractAt('GatekeeperOne',gatekeeperOneDeployment.address)
    const gatekeeperOneExploit = await ethers.getContractAt('GatekeeperOneExploit',gatekeeperOneExploitDeployment.address)
    //console.log(exploiter)

    

    const tx=await gatekeeperOneExploit.connect(exploiterAcc).exploitGatekeeper({
        gasLimit:8191*10
    })
    
    console.log(tx)
    const rcp = await tx.wait()

    console.log(rcp)
    
    expect(await gatekeeperOne.entrant(),"Exploiter couldn't pass through gate one").to.be.equal(exploiter)
    
  });
});
